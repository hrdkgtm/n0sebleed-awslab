apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: reviews
spec:
  parentRefs:
  - group: ""
    kind: Service
    name: reviews
    port: 9080
  rules:
  # Rule 1: Route Chrome user agent to reviews-v3
  - matches:
    - headers:
      - name: User-Agent
        type: RegularExpression
        value: ".*Chrome.*"
    backendRefs:
    - name: reviews-v3
      port: 9080
      weight: 100
  # Rule 2: Route all other user agents 50:50 between v1 and v2
  - matches:
    - headers:
      - name: User-Agent
        type: RegularExpression
        value: ".*"
    backendRefs:
    - name: reviews-v1
      port: 9080
      weight: 50
    - name: reviews-v2
      port: 9080
      weight: 50